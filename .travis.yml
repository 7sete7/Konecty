language: node_js
branches:
    only:
        - "/^\\d+\\.\\d+\\.\\d+$/"
        - "/^\\d+\\.\\d+\\.\\d+(-alpha)$/"
        - "/^\\d+\\.\\d+\\.\\d+(-beta\\.\\d+)$/"
        - "/^\\d+\\.\\d+\\.\\d+(-dev\\.\\d+)$/"
git:
    depth: 1
node_js:
    - '12'
cache:
    directories:
        - '$HOME/node_modules'
        - '$HOME/.meteor'
        - '$HOME/.npm'
        - '$HOME/.node-gyp'
install:
    - if [ ! -e "$HOME/.meteor/meteor" ]; then curl https://install.meteor.com | sed s/--progress-bar/-sL/g
      | /bin/sh; fi
    - export PATH="$HOME/.meteor:$PATH"
script:
    - meteor --version
    - meteor npm install
    - meteor build --server-only /tmp/build
deploy:
    provider: releases
    api_key:
			secure: xEbbmogCfTmbrtFJbfPUU9Pq+GECp1ZdTTUV6G/2wuEWq06N9KI9kUwAWDn57BsmWVjpbp0oiNV0NaBbC5KcYT8Dofl3h8Cr+CCjSVf7U13Bcn8mR0TIo3z3oF0EjU8LMJdMI3yvpFNm9Ju41S8J/p50qv5eIVoknOQCF9WQO122MJ0nl4nQ77en3p9QpskG0dQLo2LVlvZevpNvsLbZ0YLyBFGFlUVEz6K4bXVJqWmZZzYABiRlz+YP3byJU+tgKkNjrqGnetMiZJlTXs3L61P6bCIOytVZUdjfbBLQTsQNJHbhP74S86AcePNBnbTujmFhJ7JfcNsS6+gbZHyDPlLlcDHmjGWsq5otUOuAtcmepAVcWEClGH9YvAmz75UpWGhg7s3PyHAmuN1sW8CJdiD+DPGzqQX5fUVOHKN34LLlJVSvEucjG1y080JLQT357cBBmoaE0efyvw97ZkV4UC6+O1Lbvck+IkHxeZrEkbbijhiFsrRSWxfyzDSLIngEFkUVrhLPS+zwE7CwkaN2MbeH5tkprlzdqwF1SdnXCo+ZI6zAJvSpxeNPttCYZOzV5PPeg0ux3Z3vdQrhvu8N34Wacgtv122cSq/OOcbNGhr9PJ+prR7K0evHm25cKzeRxhTJhQj3bagyHl6Sj3RJ4ZzxNdted2WCT1vTJyG1Gso=
    skip_cleanup: true
    file: '/tmp/build/Konecty.tar.gz'
    on:
        tags: true
after_deploy:
    - |
        curl -H "Content-Type: application/json" \
        --data '{"source_type":"Tag","source_name":"'"$TRAVIS_TAG"'"}' \
        -X POST "https://hub.docker.com/api/build/v1/source/$DOCKERHUB_TOKEN/trigger/$DOCKERHUB_BUILD/call/"
